{% extends "layout.html" %}
{% block title %}Trang Ch·ªß - JobNest{% endblock %}

{% block content %}
<section class="hero">
  <div class="container hero-inner">
    <div class="upper-hero">
      <h1>T√¨m vi·ªác ph√π h·ª£p - Nhanh ch√≥ng & Uy t√≠n</h1>
      <p>T√¨m ki·∫øm theo v·ªã tr√≠, m·ª©c l∆∞∆°ng v√† ƒë·ªãa ƒëi·ªÉm. H√†ng ng√†n c∆° h·ªôi t·ª´ nh√† tuy·ªÉn d·ª•ng uy t√≠n.</p>

      <form id="main-search" class="search-bar" action="{{ url_for('index') }}" method="get" role="search">
        <input type="text" name="keyword" placeholder="V·ªã tr√≠, k·ªπ nƒÉng ho·∫∑c c√¥ng ty" value="{{ search.keyword }}">

        <!-- Location: readonly chips + dropdown multi-select -->
        <div class="location-select">
          <div id="location-input" class="location-input" role="button" tabindex="0">
            <span class="location-placeholder">Ch·ªçn T·ªânh/Th√†nh ph·ªë</span>
            <!-- chips inserted by JS -->
          </div>

          <input type="hidden" id="location-hidden" name="location" value="{{ search.location or '' }}">
          <div class="location-dropdown" id="location-dropdown" aria-hidden="true">
            <ul id="province-list" class="province-list">
              {% if provinces %}
                {% for p in provinces %}
                  <li>
                    <label>
                      <input type="checkbox" data-name="{{ p }}" {% if search.location and p in search.location.split(',') %}checked{% endif %}>
                      <span class="pname">{{ p }}</span>
                    </label>
                  </li>
                {% endfor %}
              {% endif %}
            </ul>
          </div>
        </div>

        <div class="salary-row">
          <input type="text" id="min_salary" name="min_salary" placeholder="M·ª©c l∆∞∆°ng t·ª´ (VNƒê)" value="{{ search.min_salary }}">
          <input type="text" id="max_salary" name="max_salary" placeholder="ƒê·∫øn (VNƒê)" value="{{ search.max_salary }}">
        </div>

        <select name="job_type">
          <option value="">Lo·∫°i c√¥ng vi·ªác</option>
          <option value="Full-time" {% if search.job_type == 'Full-time' %}selected{% endif %}>Full-time</option>
          <option value="Part-time" {% if search.job_type == 'Part-time' %}selected{% endif %}>Part-time</option>
          <option value="Remote" {% if search.job_type == 'Remote' %}selected{% endif %}>Remote</option>
          <option value="Contract" {% if search.job_type == 'Contract' %}selected{% endif %}>Contract</option>
          <option value="Intern" {% if search.job_type == 'Intern' %}selected{% endif %}>Intern</option>
        </select>

        <select name="sort_by">
          <option value="">S·∫Øp x·∫øp</option>
          <option value="newest" {% if search.sort_by == 'newest' %}selected{% endif %}>M·ªõi nh·∫•t</option>
          <option value="salary_desc" {% if search.sort_by == 'salary_desc' %}selected{% endif %}>L∆∞∆°ng cao nh·∫•t</option>
          <option value="salary_asc" {% if search.sort_by == 'salary_asc' %}selected{% endif %}>L∆∞∆°ng th·∫•p nh·∫•t</option>
        </select>

        <button type="submit" class="btn search-btn">
          <i class="fa-sharp fa-solid fa-magnifying-glass"></i>
          T√¨m ki·∫øm
        </button>
      </form>
    </div>
  </div>
</section>

<!-- FILTERS BAR (below hero) -->
<div class="filters-bar container">
  <form id="quick-filters" action="{{ url_for('index') }}" method="get" role="search">
    <input type="hidden" name="keyword" value="{{ search.keyword }}">
    <input type="hidden" id="location-hidden-quick" name="location" value="{{ search.location or '' }}">

    <div class="filter-group">
      <label>Lo·∫°i c√¥ng vi·ªác</label>
      <select name="job_type" id="flt_job_type">
        <option value="">T·∫•t c·∫£</option>
        <option value="Full-time" {% if search.job_type == 'Full-time' %}selected{% endif %}>Full-time</option>
        <option value="Part-time" {% if search.job_type == 'Part-time' %}selected{% endif %}>Part-time</option>
        <option value="Remote" {% if search.job_type == 'Remote' %}selected{% endif %}>Remote</option>
        <option value="Contract" {% if search.job_type == 'Contract' %}selected{% endif %}>Contract</option>
        <option value="Intern" {% if search.job_type == 'Intern' %}selected{% endif %}>Intern</option>
      </select>
    </div>

    <div class="filter-group">
      <label>M·ª©c l∆∞∆°ng</label>
      <div class="salary-row">
        <input type="text" id="flt_min" name="min_salary" placeholder="M·ª©c l∆∞∆°ng t·ª´ (VNƒê)" value="{{ search.min_salary }}">
        <input type="text" id="flt_max" name="max_salary" placeholder="ƒê·∫øn (VNƒê)" value="{{ search.max_salary }}">
      </div>
    </div>

    <div class="filter-actions">
      <button type="submit" class="btn primary">√Åp d·ª•ng</button>
      <button type="button" id="reset-filters" class="btn primary">ƒê·∫∑t l·∫°i</button>
    </div>
  </form>
</div>

<!-- JOBS LIST: each card is clickable (link) -->
<section class="jobs container">
  <div class="jobs-grid">
    <div class="job-list">
      <h2>C√¥ng vi·ªác n·ªïi b·∫≠t</h2>
      <div class="job-grid">
        {% for job in hot_jobs %}
          <a class="job-card-link" href="{{ url_for('job_detail', id=job.id) }}">
            <article class="job-card featured" aria-labelledby="title-{{ job.id }}">
              <div class="logo">üè¢</div>
              <div class="job-info">
                <h3 id="title-{{ job.id }}">{{ job.title }}</h3>
                <p class="muted">{{ job.company }} ¬∑ {{ job.location }}</p>
                <p class="salary">{{ job.salary | fmt_salary }} ¬∑ {{ job.job_type or '-' }}</p>
              </div>
            </article>
          </a>
        {% else %}
          <p>Kh√¥ng c√≥ c√¥ng vi·ªác n·ªïi b·∫≠t ph√π h·ª£p.</p>
        {% endfor %}
      </div>

      <h3 style="margin-top:24px">C√°c c√¥ng vi·ªác kh√°c</h3>
      <div class="job-grid">
        {% for job in other_jobs %}

            <article class="job-card" aria-labelledby="title-{{ job.id }}">
              <div class="logo">üè¢</div>
              <div class="job-info">
                <h4>{{ job.title }}</h4>
                <p class="muted">{{ job.company }} ¬∑ {{ job.location }}</p>
                <p class="salary">{{ job.salary | fmt_salary }} ¬∑ {{ job.job_type or '-' }}</p>
                <a href="{{ url_for('job_detail', id=job.id) }}">Xem chi ti·∫øt</a>
              </div>
            </article>
          </a>
        {% else %}
          <p>Kh√¥ng c√≥ c√¥ng vi·ªác n√†o.</p>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if total_pages > 1 %}
        <nav class="pagination container" aria-label="Pagination">
          <ul>
            <!-- Previous page -->
            {% if page > 1 %}
              <li>
                <a href="{{ url_for('index', page=page-1, **search) }}" class="btn secondary">Tr∆∞·ªõc</a>
              </li>
            {% endif %}

            <!-- Page numbers -->
            {% for p in range(1, total_pages + 1) %}
              <li>
                <a href="{{ url_for('index', page=p, **search) }}"
                   class="btn {% if p == page %}primary{% else %}secondary{% endif %}">
                  {{ p }}
                </a>
              </li>
            {% endfor %}

            <!-- Next page -->
            {% if page < total_pages %}
              <li>
                <a href="{{ url_for('index', page=page+1, **search) }}" class="btn secondary">Sau</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}
    </div>
  </div>
</section>

<script>
  document.getElementById('reset-filters').addEventListener('click', function() {
    document.getElementById('quick-filters').reset();
    document.getElementById('location-hidden-quick').value = '';
    window.location.href = '{{ url_for("index") }}';
  });
</script>
{% endblock %}